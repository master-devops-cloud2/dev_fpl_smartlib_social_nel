name: SonarQube Analysis  

on:  
  pull_request:  
    branches:  
      - main  
  push:  
    branches:  
      - main  

jobs:  
  sonar:  
    runs-on: ubuntu-latest  

    steps:  
      - name: Checkout code  
        uses: actions/checkout@v3  

      - name: Set up JDK 11  
        uses: actions/setup-java@v3  
        with:  
          java-version: '11'  
          distribution: adoptopenjdk

      - name: Install dependencies (Maven example)  
        run: mvn install -Dfile.encoding=UTF-8  

      - name: Run SonarQube Scan  
        env:  
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}  
        run: |  
          mvn sonar:sonar \
            -Dsonar.projectKey=YOUR_PROJECT_KEY \
            -Dsonar.host.url=https://sonarcloud.io \
            -Dsonar.organization=YOUR_ORG \
            -Dsonar.login=${{ secrets.SONAR_TOKEN }}  
            -Dfile.encoding=UTF-8   # Force UTF-8 encoding during SonarQube scan

      - name: Upload Quality Gate Status (Optional)  
        run: echo "SonarQube Quality Gate Check Complete"
