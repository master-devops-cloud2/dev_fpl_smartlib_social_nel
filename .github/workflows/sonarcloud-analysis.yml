name: SonarQube Analysis  
on:  
  pull_request:  
    branches:  
      - main  
  push:  
    branches:  
      - main  

jobs:  
  sonar:  
    runs-on: ubuntu-latest  
    steps:  
      - name: Checkout code  
        uses: actions/checkout@v3  

      - name: Set up JDK 11  
        uses: actions/setup-java@v3  
        with:  
          java-version: '11'  
          distribution: 'adoptopenjdk'  # Ajoutez la distribution ici
          java-package: jdk
          check-latest: false
          server-id: github
          server-username: GITHUB_ACTOR
          server-password: GITHUB_TOKEN
          overwrite-settings: true
          job-status: success
          token: ${{ secrets.GITHUB_TOKEN }}  # Utilisez le jeton GitHub fourni par d√©faut

      - name: Install dependencies (Maven example)  
        run: mvn install  

      - name: Run SonarQube Scan  
        env:  
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}  
        run: |  
          mvn sonar:sonar \
            -Dsonar.projectKey=elmekadem-narjiss/YOUR_PROJECT_KEY \
            -Dsonar.host.url=https://sonarcloud.io \
            -Dsonar.organization=elmekadem-narjiss \
            -Dsonar.login=${{ secrets.SONAR_TOKEN }}  

      - name: Upload Quality Gate Status (Optional)  
        run: echo "SonarQube Quality Gate Check Complete"
