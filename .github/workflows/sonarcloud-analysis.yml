name: SonarQube Analysis  

on:  
  pull_request:  
    branches:  
      - main  
  push:  
    branches:  
      - main  

jobs:  
  sonar:  
    runs-on: ubuntu-latest  

    steps:  
      - name: Checkout code  
        uses: actions/checkout@v3  
      
      - name: Set up JDK 17  
        uses: actions/setup-java@v3  
        with:  
          java-version: '17'  
          distribution: 'temurin'  

      - name: Clean Maven directory  
        run: mvn clean  

      - name: Force UTF-8 Encoding and Install dependencies  
        run: mvn install -Dproject.build.sourceEncoding=UTF-8  

      - name: Run SonarQube Scan  
        env:  
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}  
        run: |  
          mvn sonar:sonar \
            -Dsonar.projectKey=master-devops-cloud2_dev_fp_smartlib_social_nel \
            -Dsonar.host.url=https://sonarcloud.io \
            -Dsonar.organization=master-devops-cloud2 \
            -Dsonar.login=${{ secrets.SONAR_TOKEN }} \
            -Dproject.build.sourceEncoding=UTF-8  

      - name: Upload Quality Gate Status (Optional)  
        run: echo "SonarQube Quality Gate Check Complete"
